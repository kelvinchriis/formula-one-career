<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style/carreira.css">
    <title>Procure</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        .titulo-profile {
			margin: 15px 0 0 0;
			font-size: 20px;
		}

		.content-json {
			margin: 0;
			font-family: f2, sans-serif;
			font-size: 15px;
		}
    </style>
</head>
<body>
    <div style="display: flex; width: 100%;">
        <div class="header-left ">
            <!-- home -->
            <a href="tela_inicial.html">
                <i class="fa-solid fa-house fa-2xl" style="color: #000000;margin-bottom: 35px; cursor: pointer;"></i>
            </a>
            <!-- busca perfil -->
            <a href="#">
                <img src="assets/index/user-white.png" style="width: 42px; height: auto; margin-bottom: 25px; cursor: pointer;">
            </a>
            <!-- perfil pessoal -->
            <a href="perfil.html">
                <i class="fa-solid fa-user fa-2xl" style="color: #000000;margin-bottom: 50px; cursor: pointer;"></i>
            </a>
            <a href="graf.html">
                <i class="fa-solid fa-star fa-2xl" style="color: #000000;margin-bottom: 55px; cursor: pointer;"></i>
            </a>
            <!-- sair -->
            <i onclick="sair()" class="fa-solid fa-right-from-bracket fa-2xl"
                style="color: #000000; margin-bottom: 46px; cursor: pointer;"></i>
        </div>
        
        <div class="dash">
            <div class="over" id="over" style="display: none; position: absolute; align-items: flex-start;">
                <div style="width: 7%; margin-top: 10px; display: flex; justify-content: flex-end; position: fixed;">
                    <div
                        id="botao" onclick="voltar()" style="width: 200px; user-select: none; cursor: pointer; height: 40px; border-radius: 20px; display: flex; justify-content: center; align-items: center;">
                        <img src="assets/index/voltar.png" style="width: 30px;" alt="">    
                        <h1 style="margin: 0;" >Voltar</h1>
                    </div>
                </div>
                <div style="display: flex; width: 100%; align-items: center; justify-content: center; margin-top: 30px;">
                    <div
                        style=" width: 800px; height: 700px; border-radius: 20px; background-color: rgba(0, 0, 0, 0.2); margin-top: 20px; padding: 0 20px;">
                        <div
                            style="display: flex; width: 100%; height: 300px; justify-content: space-between; margin-top: 10px;">
                            <div class="box-escuderia" style="height: 80%; width: 35%; margin-bottom: 0; margin: 0; ">
                                <img style="width: 70%;" id="img_scud">
                            </div>
    
                            <div class="box-car" style="height: 80%; margin: 0;  width: 53%;">
                                <label style="font-size: 18pt"></label>
                                <img id="img_car">
                            </div>
                        </div>
                        <div
                            style="display: flex; width: 100%; height: 400px;  justify-content: space-between; margin: 0;">
                            <div class="card-pilot" data-id="1"
                                style="margin: 0; width: 55%; height: 430px;  height: 90%;">
                                <h1 style="margin: 0;" id="nome_pilot"></h1>
                                <img class="img-pilot" id="img_pilot">
                            </div>
                            <div class="card" style="margin: 0; height: 90%; ">
                                <img id="img_circuit" style="width: 100%">
                                <div>
                                    <div class="line-card">
                                        <div class="data-card">
                                            <span>Primeiro Grande Prêmio</span>
                                            <h2>2004</h2>
                                        </div>
                                        <div class="data-card">
                                            <span>Número de Voltas</span>
                                            <h2>57</h2>
                                        </div>
                                    </div>
                                    <div class="line-card">
                                        <div class="data-card">
                                            <span>Comprimento do circuito</span>
                                            <h2>5.412 KM</h2>
                                        </div>
                                        <div class="data-card">
                                            <span>Distância da corrida</span>
                                            <h2>308 KM</h2>
                                        </div>
                                    </div>
    
                                </div>
                            </div>
    
    
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; width: 400px;">
                        <div style="display: flex; flex-direction: column; width: 100%; align-items: center;">
                            <div class="img-user" style="border: 2px solid red;" id="img_user_profile" style="margin: 0 0 30px 0;"></div>
                            
                            <div style="width: 80%; text-align: center;">
                                <h2 class="titulo-profile">Username</h2>
                                <h2 class="content-json" id="nome"></h2>
                                <h2 class="titulo-profile">Nacionalidade</h2>
                                <h2 class="content-json" id="nasci"></h2>
                                <h2 class="titulo-profile">Data Nascimento</h2>
                                <h2 class="content-json" id="dtnasc"></h2>
                                <h2 class="titulo-profile">Número carro</h2>
                                <h2 class="content-json" style="font-size: 10pt; font-weight: 0;" id="num"></h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- create perfil init -->
            <div class="main" id="initt" style="flex-direction: column;">
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <h2 style="margin-top: 20px;">Digite o username</h2>
                    <input type="text" oninput="buscar_perfil()" id="inputUsername" placeholder="Username">
                </div>
                <div class="tela-user" id="show_users">
                </div>
            </div>
        </div>
    </div>
    <script src="js/script.js"></script>
</body>
</html>
<script>

    var nomes_pilotos = [
        'null',
        'Ayton Senna',
        'Schumacher',
        'Hamilton',
        'Fangio',
        'Alain Prost',
        'Niki Lauda',
        'Jackie Stewart',
        'Vettel',
        'Alonso',
        'Nigell Mansell',
        'Fittipaldi',
        'Nelson Piquet',
        'Jochen Rindt',
        'Kimi Räikkönen',
    ]

    let perfisExibidos = [];
    var perfil_user = null

    function buscar_perfil() {
        const username = inputUsername.value;
        if (username === "") {
            show_users.innerHTML = "";
            perfisExibidos = [];
            return;
        }

        fetch(`perfil/perfil/${username}`, {
            method: "GET",
        })
            .then(function (response) {
                if (!response.ok) {
                    throw new Error('Erro ao carregar os dados');
                }
                return response.json();
            })
            .then(function (perfis) {
                console.log(perfis);

                if (!perfis || perfis.length === 0) {
                    show_users.innerHTML = "";
                    perfisExibidos = [];
                    console.error('Nenhum dado de perfil encontrado.');
                    return;
                }

                const perfisFiltrados = perfis.filter(perfil => perfil.username.toLowerCase().startsWith(username.toLowerCase()));

                // Remover perfis que não correspondem à busca atual
                perfisExibidos = perfisExibidos.filter(perfil => perfisFiltrados.some(p => p.username === perfil));

                show_users.innerHTML = "";
                perfisFiltrados.forEach(perfil => {
                    if(perfil.imagem == null){
                        show_users.innerHTML += `
                            <div class="card-user" data-id="${perfil.idPerfil}">
                                <h1 id="name_user">${perfil.username}</h1>
                                <div class="img-user imm" id="img_user"></div>
                            </div>
                        `;
                    } else {
                        show_users.innerHTML += `
                            <div class="card-user" data-id="${perfil.idPerfil}">
                                <h1 id="name_user">${perfil.username}</h1>
                                <div class="img-user imm" style="background-image: url('assets/usuarios/${perfil.imagem}');" id="img_user"></div>
                            </div>
                        `;
                    }
                    
                    perfisExibidos.push(perfil.username);
                });
                var card = document.querySelectorAll('.card-user');
                for (var i = 0; i < card.length; i++) {
                    card[i].addEventListener('click', selectPerfil);
                }
            })
            .catch(function (error) {
                console.error('Erro:', error);
            });
    }
    
    

    function selectPerfil() {
        var id = this.getAttribute('data-id');
        perfil_user = id
        initt.style.display = "none"
        buscarPerfil(perfil_user)
    }

    function buscarPerfil(id) {
		fetch(`/perfil/myprofile/${id}`, {
			method: "GET",
		})
			.then(function (response) {
				if (!response.ok) {
					throw new Error('Erro ao carregar os dados');
				}
				return response.json();
			})
			.then(function (perfil) {
				console.log(perfil);

				if (!perfil || perfil.length === 0) {
					console.error('perfil não encontrado.');
					return;
				}

				var dataString = perfil[0].dataNasc;
				var data = new Date(dataString);
				var dia = String(data.getUTCDate()).padStart(2, '0');
				var mes = String(data.getUTCMonth() + 1).padStart(2, '0'); // O mês começa do zero, então adicionamos 1
				var ano = data.getUTCFullYear();
				var dataFormatada = dia + '-' + mes + '-' + ano;

				nome.innerHTML = `${perfil[0].username}`
				nasci.innerHTML = `${perfil[0].nacionalidade}`
				dtnasc.innerHTML = `${dataFormatada}`
                nome_pilot.innerHTML = `${nomes_pilotos[perfil[0].fkPilotoInspiracao]}`
				num.innerHTML = `${perfil[0].numeroCarro}`
				img_scud.src = `assets/escuderias/${perfil[0].fkEquipe}.png`
				img_car.src = `assets/carros/${perfil[0].fkCarro}.png`
				img_pilot.src = `assets/pilotos/${perfil[0].fkPilotoInspiracao}.png`
				img_circuit.src = `./assets/circuitos/${perfil[0].fkPistaPreferida}.png`
                if(perfil[0].imagem != null) {
                    img_user_profile.style.backgroundImage = `url('assets/usuarios/${perfil[0].imagem}')`
                } else {
                    img_user_profile.style.backgroundImage = `url('assets/index/user.jpg')`
                    
                }
                over.style.display = "block"
			})
			.catch(function (error) {
				console.error('Erro:', error);
			});
	}

    function voltar() {
        over.style.display = "none"
        initt.style.display = "flex"
    }

</script>