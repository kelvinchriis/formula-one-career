<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style/carreira.css">
    <title>Circuitos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        #drop-area {
            display: flex;
            align-items: center;
            justify-content: space-around;
            border: 3px dashed #180e0e75;
            background-color: rgba(255, 228, 196, 0.555);
            width: 60%;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            margin: 20px;
        }

        #drop-area.highlight {
            border-color: purple;
        }

        #preview {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 20px;
        }

        .coment {
            width: 80%;
            background-color: azure;
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 13px rgba(0, 0, 0, 0.39);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .perfil {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .img-user-coment {
            margin: 0;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: white;
            background-image: url("../assets/index/user.jpg");
            background-size: cover;
        }

        .content-coment {
            width: 800px;
            padding: 30px 0;
            display: flex;
            flex-direction: column;
            align-items: center
        }

        .coment-com {
            width: 85%;
            margin-top: 15px;
        }

        .h1-coment {
            font-size: 12pt;
            margin: 0 0 15px 0;
        }

        .textarea {
            background-color: white;
        }

        .make {
            background-color: rgba(100, 0, 0, 0.2);
            margin: 0;
        }

        .perfil-link {
            cursor: pointer;
            display: flex;
            align-items: center;
        }
    </style>
</head>

<body onload="listar_coments()">
    <div style="display: flex; width: 100%;">
        <div class="header-left ">
            <!-- home -->
            <a href="tela_inicial.html">
                <i class="fa-solid fa-house fa-2xl" style="color: #000000;margin-bottom: 35px; cursor: pointer;"></i>
            </a>
            <!-- busca perfil -->
            <a href="profiles.html">
                <img src="assets/index/user-black.png"
                    style="width: 42px; height: auto; margin-bottom: 25px; cursor: pointer;">
            </a>
            <!-- feed coment -->
            <a href="#">
                <i class="fa-solid fa-comments fa-2xl" style="color: #ffffff; margin-bottom: 50px; cursor: pointer;"></i>
            </a>
            <!-- perfil pessoal -->
            <a href="perfil.html">
                <i class="fa-solid fa-user fa-2xl" style="color: #000000;margin-bottom: 50px; cursor: pointer;"></i>
            </a>
            <a href="#">
                <i class="fa-solid fa-star fa-2xl" style="color: #000000;margin-bottom: 55px; cursor: pointer;"></i>
            </a>
            <!-- sair -->
            <i onclick="sair()" class="fa-solid fa-right-from-bracket fa-2xl"
                style="color: #000000; margin-bottom: 46px; cursor: pointer;"></i>
        </div>
        <div class="dash">
            <div class="over" id="over" style="display: none; position: absolute; align-items: flex-start;">
                <div style="width: 7%; margin-top: 10px; display: flex; justify-content: flex-end; position: fixed;">
                    <div
                        id="botao" onclick="voltar()" style="width: 200px; user-select: none; cursor: pointer; height: 40px; border-radius: 20px; display: flex; justify-content: center; align-items: center;">
                        <img src="assets/index/voltar.png" style="width: 30px;" alt="">    
                        <h1 style="margin: 0;" >Voltar</h1>
                    </div>
                </div>
                <div style="display: flex; width: 100%; align-items: center; justify-content: center; margin-top: 30px;">
                    <div
                        style=" width: 800px; height: 700px; border-radius: 20px; background-color: rgba(0, 0, 0, 0.2); margin-top: 20px; padding: 0 20px;">
                        <div
                            style="display: flex; width: 100%; height: 300px; justify-content: space-between; margin-top: 10px;">
                            <div class="box-escuderia" style="height: 80%; width: 35%; margin-bottom: 0; margin: 0; ">
                                <img style="width: 70%;" id="img_scud">
                            </div>
    
                            <div class="box-car" style="height: 80%; margin: 0;  width: 53%;">
                                <label style="font-size: 18pt"></label>
                                <img id="img_car">
                            </div>
                        </div>
                        <div
                            style="display: flex; width: 100%; height: 400px;  justify-content: space-between; margin: 0;">
                            <div class="card-pilot" data-id="1"
                                style="margin: 0; width: 55%; height: 430px;  height: 90%;">
                                <h1 style="margin: 0;" id="nome_pilot"></h1>
                                <img class="img-pilot" id="img_pilot">
                            </div>
                            <div class="card" style="margin: 0; height: 90%; ">
                                <img id="img_circuit" style="width: 100%">
                                <div>
                                    <div class="line-card">
                                        <div class="data-card">
                                            <span>Primeiro Grande Prêmio</span>
                                            <h2>2004</h2>
                                        </div>
                                        <div class="data-card">
                                            <span>Número de Voltas</span>
                                            <h2>57</h2>
                                        </div>
                                    </div>
                                    <div class="line-card">
                                        <div class="data-card">
                                            <span>Comprimento do circuito</span>
                                            <h2>5.412 KM</h2>
                                        </div>
                                        <div class="data-card">
                                            <span>Distância da corrida</span>
                                            <h2>308 KM</h2>
                                        </div>
                                    </div>
    
                                </div>
                            </div>
    
    
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; width: 400px;">
                        <div style="display: flex; flex-direction: column; width: 100%; align-items: center;">
                            <div class="img-user" style="border: 2px solid red;" id="img_user_profile" style="margin: 0 0 30px 0;"></div>
                            
                            <div style="width: 80%; text-align: center;">
                                <h2 class="titulo-profile">Username</h2>
                                <h2 class="content-json" id="nome"></h2>
                                <h2 class="titulo-profile">Nacionalidade</h2>
                                <h2 class="content-json" id="nasci"></h2>
                                <h2 class="titulo-profile">Data Nascimento</h2>
                                <h2 class="content-json" id="dtnasc"></h2>
                                <h2 class="titulo-profile">Número carro</h2>
                                <h2 class="content-json" style="font-size: 10pt; font-weight: 0;" id="num"></h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="main" id="initt">

                <div class="content-coment">
                    <div class="coment make">
                        <div class="perfil">
                            <div class="perfil-link" id="perfil_link">
                                <div class="img-user-coment" id="img_user"></div>
                                <h1 style="margin: 0 0 0 6px;" id="user"></h1>
                            </div>
                        </div>
                        <div class="coment-com">
                            <textarea class="textarea" rows="6" cols="40" style="width: 90%;" id="inputComent"
                                placeholder="Faça um comentário" maxlength="150" style="margin-bottom: 10px"></textarea>
                        </div>
                        <div id="drop-area" ondragover="manipularArrastarSobre(event)" ondrop="manipularSoltar(event)"
                            ondragenter="manipularEntradaArrastar(event)" ondragleave="manipularSaidaArrastar(event)">
                            <h1 style="margin: 0; font-size: 12pt;">Arraste sua imagem</h1>
                            <input type="file" id="foto" accept="image/*" onchange="selecionarImg(event)"
                                style="display: none;">
                            <label
                                style="padding: 10px; background-color: rgb(161, 36, 36); border-radius: 10px; color: white; cursor: pointer;"
                                for="foto">Buscar</label>
                        </div>

                        <div id="preview"></div>
                        <button onclick="publicar()">publicar</button>
                    </div>
                </div>

                <div class="content-coment" id="coments">

                    <!-- comentario aqui -->

                </div>

            </div>
        </div>
        <script src="js/buscar_perfil.js"></script>
</body>

</html>



<script>

    perfil_link.setAttribute('data-id', sessionStorage.FK_PERFIL)
    perfil_link.addEventListener('click', selectPerfil);

    img_user.style.backgroundImage = `url('assets/usuarios/${sessionStorage.IMAGEM}')`
    user.innerHTML = sessionStorage.NOME_USUARIO

    function manipularArrastarSobre(event) {
        event.preventDefault();
    }

    function manipularEntradaArrastar(event) {
        event.preventDefault();
        document.getElementById('drop-area').classList.add('highlight');
    }

    function manipularSaidaArrastar(event) {
        event.preventDefault();
        document.getElementById('drop-area').classList.remove('highlight');
    }

    function manipularSoltar(event) {
        event.preventDefault();
        document.getElementById('drop-area').classList.remove('highlight');

        const files = event.dataTransfer.files;
        if (files.length > 0) {
            imagemSelecionada(files[0]);
        }
    }

    function selecionarImg(event) {
        const imagem = event.target.files;
        if (imagem.length > 0) {
            imagemSelecionada(imagem[0]);
        }
    }

    function imagemSelecionada(file) {
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function (event) {
                const img = new Image();
                img.src = event.target.result;
                img.onload = function () {
                    const preview = document.getElementById('preview');
                    preview.innerHTML = '';
                    preview.style.width = "100%"
                    preview.appendChild(img);
                };
            };
            reader.readAsDataURL(file);
        } else {
            alert('Por favor, selecione um arquivo de imagem.');
        }
    }
</script>
<!-- -- listar todos
select c.*, p.username from comentarios as c join perfil as p on fkPerfilComent = idPerfil order by dataComent desc;
-- listar do user
select c.*, p.username from comentarios as c join perfil as p on fkPerfilComent = idPerfil where p.idPerfil = 1 order by dataComent desc; -->

<script>
    function publicar() {
        preview.innerHTML = ""
        var comentario = inputComent.value
        inputComent.value = ""
        var formData = new FormData();
        formData.append('foto', foto.files[0])
        formData.append('comentario', comentario)
        formData.append('id_user', sessionStorage.FK_PERFIL);

        if(comentario == "") return false

        fetch(`/comentarios/publicar`, {
          method: "POST",
          body: formData,
        })
          .then(function (resposta) {
            console.log("resposta: ", resposta);
      
            if (resposta.ok) {
                listar_coments() 
            } else {
              throw "Houve um erro ao tentar realizar o cadastro!";
            }
          })
          .catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
          });
      
        return false;
    }

    function listar_coments() {
        coments.innerHTML = ``
        fetch(`comentarios/listar/`, {
            method: "GET",
        })
            .then(function (response) {
                if (!response.ok) {
                    throw new Error('Erro ao carregar os dados');
                }
                return response.json();
            })
            .then(function (comentario) {
                console.log(comentario);

                if (!comentario || comentario.length === 0) {
                    console.error('Nenhum dado de perfil encontrado.');
                    return;
                }
                for(i=comentario.length-1; i>=0; i--) {
                    coments.innerHTML += `
                        <div class="coment">
                            <div class="perfil">
                                <div class="perfil-link" data-id="${comentario[i].idPerfil}">
                                    <div class="img-user-coment" style="background-image: url('assets/usuarios/${comentario[i].imagem}');"></div>
                                    <h1 style="margin: 0 0 0 6px;" id="user">${comentario[i].username}</h1>
                                </div>
                            </div>
                            <div class="coment-com">
                                <h1 class="h1-coment">${comentario[i].comentario}</h1>
                            </div>
                            <img src="assets/usuarios/${comentario[i].img_coment}" alt="">
                            <div style="width: 95%; text-align: right;">
                                <h3 style="margin: 0;">${comentario[i].dataComent}</h3>
                            </div>
                        </div>
                    `   
                }
                var perfil = document.querySelectorAll('.perfil-link');
                for (var i = 0; i < perfil.length; i++) {
                    perfil[i].addEventListener('click', selectPerfil);
                }
            })
            .catch(function (error) {
                console.error('Erro:', error);
            });
    }
</script>